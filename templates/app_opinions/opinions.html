{% extends 'base.html' %}
{% load static %}
{% load opinions_extras %}

{% block my_css %}
    <style>
        .mark-green {
            font-size: 16px;
            color: #00B000;
        }

        .mark-red {
            font-size: 16px;
            color: #B00000;
        }

        .mark-yellow {
            font-size: 16px;
            color: #e9d400;
        }

        .opinion-text {
            padding-right: 20px;
            word-wrap: break-word;
            overflow: visible;
        }

    </style>
{% endblock %}

{% block my_js %}
    <script type="text/javascript" src="{% static 'ajax.js' %}"></script>
    <script>

        function vote(opinion_pk, vote_type) {
            var data = {'opinion': opinion_pk, 'vote': vote_type};
            ajax("{% url 'app_opinions:vote_for_opinion' %}", data, function(result) {
                var counter = $("#" + vote_type + "-" + opinion_pk);
                var counterValue = parseInt(counter.text()) + 1;
                counter.html(counterValue);

                var upvoteDiv = $("#p1-" + opinion_pk);
                upvoteDiv.attr('style', '');
                upvoteDiv.parent().attr('onclick', '');

                var downvoteDiv = $("#p0-" + opinion_pk);
                downvoteDiv.attr('style', 'margin-left: 10px;');
                downvoteDiv.attr('onclick', '');
            });
        }

    </script>
{% endblock %}

{% block page_header %}
    Nuomonės {{ tour_object.title }}
{% endblock %}

{% block content %}

    <div class="row">
        <div class="col-sm-12">
            <div class="box box-primary">
            <div class="box-header with-border">
              <h3 class="box-title">{{ tour_object.title }} - Nuomonės</h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body">
              <ul class="products-list product-list-in-box">
                  {% for opinion in opinionsList %}
                    <li class="item">
                      <div class="product-info" style="margin-left: 20px;">
                          <div class="product-img" style="margin-right: 15px;">
                              <p>
                                {% with opinion.mark as mark %}
                                  <i style="vertical-align: top; font-size: 30px; margin-top: 0"
                                     {% if mark == '2' %}class="fa-fw glyphicon glyphicon-thumbs-up mark-green"
                                     {% elif mark == '1' %}class="fa-fw glyphicon glyphicon-hand-right mark-yellow"
                                     {% elif mark == '0' %}class="fa-fw glyphicon glyphicon-thumbs-down mark-red"{% endif %}
                                  ></i>
                                {% endwith %}
                              </p>
                          </div>
                        <a style="cursor: default;" class="product-title">{{ opinion.user.username }}
                        </a>
                        <span class="opinion-text">
                          <br><br>
                          {% for par in opinion.comment|by_paragraphs %}
                              <p class="opinion-text">{{ par }}</p>
                          {% endfor %}

                          <div class="pull-left">
                            {% with opinion|opinion_votes:votesList as opinion_votes %}
                            {% with opinion_votes|i_did_not_vote:request.user.pk as not_voted %}

                              <div id="p0-{{ opinion.pk }}" class="pull-right mark-red"
                                   {% if not_voted %} style="margin-left: 10px; cursor: pointer;" onclick="vote({{ opinion.pk }}, '0')"
                                   {% else %} style="cursor: default; margin-left: 10px;"{% endif %}
                                  ><i class="fa fa-fw fa-thumbs-down"></i>
                                  <span id="0-{{ opinion.pk }}" style="font-size:17px;">{{ opinion_votes|get_votes:'0' }}</span>
                              </div>
                              <div id="p1-{{ opinion.pk }}" class="pull-right mark-green"
                                   {% if not_voted %} style="cursor: pointer;" onclick="vote({{ opinion.pk }}, '1')"
                                   {% else %} style="cursor: default;"{% endif %}
                                  ><i class="fa fa-fw fa-thumbs-up"></i>
                                  <span id="1-{{ opinion.pk }}" style="font-size:17px;">{{ opinion_votes|get_votes:'1' }}</span>
                              </div>

                            {% endwith %}
                            {% endwith %}
                          </div>

                          <p style="color: #777; padding-right: 20px;" class="opinion-text pull-right">
                              {{ opinion.date_posted|date:'Y-m-d H:i' }}
                          </p>
                        </span>
                      </div>
                    </li>
                  {% endfor %}
              </ul>
            </div>
          </div>
        </div>
    </div>

    <div class="row" style="margin-top:150px;">
        <div class="col-sm-12">
            <div class="box box-primary">
                <div class="box-header with-border">
                  <h3 class="box-title">Rašyti komentarą</h3>
                </div>
            </div>
            <div class="box-body">

            </div>
        </div>
    </div>

{% endblock %}